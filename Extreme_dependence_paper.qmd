---
title: "Extremal dependence paper"
format: html
---

The aim is to recreate the analysis and plots from *Dependence Measures for Extreme Value Analysis* paper by Stuart Coles and Jonathan Tawn.

```{r}
#| echo: false
#| message: false
#| warning: false
library(tidyverse)
library(latex2exp)
library(ismev)
```

There are $3$ datasets in the paper. First, temperature data from Oxford and Worthing examines spatial dependence of extremely high temperatures. Second, precipitation data from Oxford to examine time dependence of precipitation. Third, dependence between surge levels and tides for extreme sea levels. 

```{r}
data(wavesurge)
# plot the wavesurge data
ggplot(wavesurge) + geom_point(aes(x=wave,y=surge))+ theme_minimal() + theme(aspect.ratio = 1) + xlab("Wave height") + ylab("Surge level")

```
Using the probability integral transform (PIT), plot the quantiles.

```{r}
# create x and y quantile variables
U <- wavesurge %>% select(wave) %>% arrange(wave) %>% mutate(u=row_number()/(nrow(wavesurge)+1))
V <- wavesurge %>% select(surge) %>% arrange(surge) %>% mutate(v=row_number()/(nrow(wavesurge)+1)) 
# examine top and bottom
U %>% head()
U %>% tail()
V %>% head()
V %>% tail()
df <- wavesurge %>% left_join(U,by="wave") %>% left_join(V,by="surge")
df
```
Now plot the values on the $U(0,1)$ scale to replicate (c) of Figure $5$.

```{r}
ggplot(df)+ geom_point(aes(x=u,y=v))+ theme_minimal() + theme(aspect.ratio = 1) + xlab("Wave height") + ylab("Surge level")
```

Now, try to replicate Figure $10$ to plot the dependence measures $\chi(u)$ and $\Bar{\chi(u)}$.We need to calculate the empirical estimate of $C(u,u)$. Each marginal distribution is estimated by its empirical distribution function. The confidence intervals are constructed using the delta method.

```{r}

```

### Dependence measures

Theoretical part of the paper involves plotting the dependence measures $\chi(u)$ and $\Bar{\chi(u)}$.

```{r}

```

